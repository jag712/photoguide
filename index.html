<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쮸쀼의 비밀교실 (✨)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jamo-js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
            color: #4A4A4A;
        }
        .nav-item { transition: all 0.2s ease-in-out; }
        .nav-item.active {
            background-color: #4A5568;
            color: #FFFFFF;
            transform: translateX(4px);
        }
        .nav-item:not(.active):hover {
            background-color: #E2E8F0;
            color: #2D3748;
        }
        .content-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: box-shadow 0.3s ease;
        }
        .content-card:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .question { cursor: pointer; }
        .answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.7s ease-in-out, padding 0.5s ease-in-out;
            padding: 0 1.5rem;
        }
        .answer.open {
            max-height: 5000px;
            padding: 1.5rem;
        }
        .fa-chevron-down { transition: transform 0.3s ease-in-out; }
        .question.open .fa-chevron-down { transform: rotate(180deg); }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 40vh;
        }
        @media (min-width: 768px) { .chart-container { height: 400px; } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #F1F1F1; }
        ::-webkit-scrollbar-thumb { background: #A0AEC0; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #718096; }
        
        /* Specific component styles */
        .stop-btn { transition: background-color 0.2s ease-in-out; }
        .stop-btn.active { background-color: #4A5568; color: white; }
        .ai-btn {
            display: inline-flex; align-items: center; padding: 0.25rem 0.75rem; font-size: 0.75rem; font-weight: 500;
            border-radius: 9999px; background-color: #f3f4f6; color: #4b5563; transition: background-color 0.2s;
            border: 1px solid #e5e7eb; cursor: pointer;
        }
        .ai-btn:hover { background-color: #e5e7eb; }
        .ai-btn i { margin-right: 0.375rem; }
        .prose { color: #374151; line-height: 1.65; }
        .prose strong { font-weight: 600; }
        .prose p { margin-bottom: 1em; }
        .quiz-option { border: 2px solid #E2E8F0; transition: all 0.2s ease; }
        .quiz-option:hover { border-color: #4A5568; background-color: #f7fafc; }
        .quiz-option.selected { border-color: #4A5568; background-color: #E2E8F0; }
        .quiz-option.correct { background-color: #C6F6D5; border-color: #38A169; }
        .quiz-option.incorrect { background-color: #FED7D7; border-color: #E53E3E; }
        .zone-bar-container { display: flex; width: 100%; }
        .zone-bar { flex: 1; text-align: center; padding: 0.5rem 0; font-weight: bold; color: white; font-size: 0.8rem; }
        .zone-bar-info { font-size: 0.7rem; text-align: center; }
        .diagram-item { display: flex; flex-direction: column; align-items: center; text-align: center; min-width: 120px; }
        .diagram-icon-box { border: 2px solid #cbd5e1; border-radius: 0.75rem; padding: 0.75rem; margin-bottom: 0.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 110px; height: 110px; }
        .profile-tag { font-size: 0.7rem; margin-top: 0.25rem; padding: 0.25rem 0.5rem; border-radius: 0.375rem; font-weight: 500; }
    </style>
</head>
<body class="antialiased bg-gray-50">
    <div class="flex flex-col md:flex-row min-h-screen">
        <nav class="w-full md:w-64 bg-white p-4 md:p-6 shadow-lg md:shadow-none shrink-0 z-10">
            <a href="#" id="homeLink" data-category="home" class="flex items-center mb-6 cursor-pointer">
                <i class="fas fa-camera-retro text-3xl text-gray-700 mr-3"></i>
                <h1 class="text-xl font-bold text-gray-800">쮸쀼의 비밀교실✨</h1>
            </a>
            <div class="mb-4">
                <input type="text" id="searchInput" placeholder="용어 검색..." class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-400">
            </div>
            <ul>
                <li><a href="#" class="nav-item block py-3 px-4 mb-2 rounded-lg font-semibold text-gray-700 active" data-category="home">일정</a></li>
                <li><a href="#" class="nav-item block py-3 px-4 mb-2 rounded-lg font-semibold text-gray-700" data-category="visualization">시각화</a></li>
                <li><a href="#" class="nav-item block py-3 px-4 mb-2 rounded-lg font-semibold text-gray-700" data-category="cms">CMS 가이드</a></li>
                <li><a href="#" class="nav-item block py-3 px-4 mb-2 rounded-lg font-semibold text-gray-700" data-category="structure">카메라 구조와 원리</a></li>
                <li><a href="#" class="nav-item block py-3 px-4 mb-2 rounded-lg font-semibold text-gray-700" data-category="exposure">노출</a></li>
                <li><a href="#" class="nav-item block py-3 px-4 mb-2 rounded-lg font-semibold text-gray-700" data-category="lens">렌즈와 광학</a></li>
                <li><a href="#" class="nav-item block py-3 px-4 mb-2 rounded-lg font-semibold text-gray-700" data-category="digital">디지털</a></li>
                <li><a href="#" class="nav-item block py-3 px-4 mb-2 rounded-lg font-semibold text-gray-700" data-category="film">필름과 현상</a></li>
                <li><a href="#" class="nav-item block py-3 px-4 mb-2 rounded-lg font-semibold text-gray-700" data-category="lighting">조명과 필터</a></li>
                <li><a href="#" class="nav-item block py-3 px-4 mb-2 rounded-lg font-semibold text-gray-700" data-category="history">사진사 & 사조</a></li>
            </ul>
            <div class="mt-6">
                <button id="quizBtn" class="w-full bg-gray-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-800 transition-colors"><i class="fas fa-magic mr-2"></i> AI 퀴즈 생성</button>
            </div>
        </nav>

        <main id="mainContent" class="flex-1 p-4 md:p-10 overflow-y-auto">
        </main>
    </div>

    <!-- Gemini AI Modal -->
    <div id="geminiModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 transition-opacity duration-300">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col transform transition-all duration-300 scale-95">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 id="modalTitle" class="text-xl font-bold text-gray-800 flex items-center"><i class="fas fa-robot text-blue-500 mr-3"></i>AI 어시스턴트</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-800 text-3xl font-light">&times;</button>
            </div>
            <div id="modalContent" class="p-6 overflow-y-auto">
                 <div id="loadingSpinner" class="hidden flex justify-center items-center h-48">
                    <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-gray-900"></div>
                </div>
                <div id="modalResponse" class="prose max-w-none"></div>
            </div>
        </div>
    </div>
    
    <script src="data.js"></script>
    <script>
    // --- DOM Elements ---
    const mainContent = document.getElementById('mainContent');
    const searchInput = document.getElementById('searchInput');
    const quizBtn = document.getElementById('quizBtn');
    const geminiModal = document.getElementById('geminiModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalResponse = document.getElementById('modalResponse');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const closeModalBtn = document.getElementById('closeModalBtn');
    
    // --- Global State ---
    let charts = {};
    let currentQuizData = null;
    let currentQuestionIndex = 0;
    let score = 0;

    // --- Gemini API Call ---
    async function callGeminiAPI(prompt, useSchema = false) {
        showModal();
        modalResponse.innerHTML = '';
        loadingSpinner.classList.remove('hidden');

        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        
        const payload = {
            contents: [{ parts: [{ text: prompt }] }],
            generationConfig: {}
        };

        if (useSchema) {
            payload.generationConfig.responseMimeType = "application/json";
            payload.generationConfig.responseSchema = {
                type: "OBJECT",
                properties: { questions: { type: "ARRAY", items: { type: "OBJECT", properties: { question: { type: "STRING" }, options: { type: "ARRAY", items: { type: "STRING" } }, answer: { type: "STRING" } }, required: ["question", "options", "answer"] } } } }
            };
        }

        try {
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) throw new Error(`API request failed: ${response.status}`);
            const result = await response.json();
            const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
            if (!text) throw new Error("No content received from API.");
            return text;
        } catch (error) {
            console.error("Gemini API Error:", error);
            modalResponse.innerHTML = `<p class="text-red-500">AI 기능을 호출하는 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.</p>`;
            return null;
        } finally {
            loadingSpinner.classList.add('hidden');
        }
    }

    // --- Modal Control ---
    function showModal() {
        geminiModal.classList.remove('hidden');
        setTimeout(() => geminiModal.querySelector('div > div').classList.remove('scale-95'), 10);
    }

    function hideModal() {
        geminiModal.querySelector('div > div').classList.add('scale-95');
        setTimeout(() => geminiModal.classList.add('hidden'), 300);
    }
    
    // --- Quiz Functions ---
    function displayQuizQuestion() {
        const q = currentQuizData.questions[currentQuestionIndex];
        const optionsHtml = q.options.map(option => `<div class="quiz-option p-4 rounded-lg cursor-pointer mb-2" data-option="${option.replace(/"/g, '&quot;')}">${option}</div>`).join('');
        modalResponse.innerHTML = `
            <div class="mb-4"><p class="text-sm text-gray-500">문제 ${currentQuestionIndex + 1} / ${currentQuizData.questions.length}</p><p class="text-lg font-semibold mt-1">${q.question}</p></div>
            <div id="quizOptions">${optionsHtml}</div><div id="quizResult" class="mt-4 font-semibold"></div>
            <div class="flex justify-end mt-4"><button id="nextQuestionBtn" class="bg-gray-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-800 hidden">다음 문제</button></div>`;
        modalResponse.querySelectorAll('.quiz-option').forEach(option => option.addEventListener('click', () => checkQuizAnswer(option)));
        modalResponse.querySelector('#nextQuestionBtn').addEventListener('click', () => {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuizData.questions.length) displayQuizQuestion();
            else displayQuizFinalScore();
        });
    }

    function checkQuizAnswer(selectedOptionEl) {
        modalResponse.querySelectorAll('.quiz-option').forEach(opt => { opt.classList.remove('selected'); opt.style.pointerEvents = 'none'; });
        selectedOptionEl.classList.add('selected');
        const selectedAnswer = selectedOptionEl.dataset.option;
        const correctAnswer = currentQuizData.questions[currentQuestionIndex].answer;
        modalResponse.querySelectorAll('.quiz-option').forEach(opt => {
            if (opt.dataset.option === correctAnswer) opt.classList.add('correct');
            else if (opt.classList.contains('selected')) opt.classList.add('incorrect');
        });
        if (selectedAnswer === correctAnswer) {
            score++;
            modalResponse.querySelector('#quizResult').innerHTML = `<p class="text-green-600">정답입니다!</p>`;
        } else {
            modalResponse.querySelector('#quizResult').innerHTML = `<p class="text-red-600">오답입니다. 정답은 "${correctAnswer}" 입니다.</p>`;
        }
        modalResponse.querySelector('#nextQuestionBtn').classList.remove('hidden');
    }

    function displayQuizFinalScore() {
        modalResponse.innerHTML = `
            <div class="text-center"><h2 class="text-2xl font-bold mb-4">퀴즈 완료!</h2>
            <p class="text-lg">총 ${currentQuizData.questions.length}문제 중 <span class="font-bold text-xl text-gray-800">${score}</span>문제를 맞혔습니다.</p>
            <button id="restartQuizBtn" class="mt-6 bg-gray-700 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-800">다시 풀기</button></div>`;
        modalResponse.querySelector('#restartQuizBtn').addEventListener('click', generateQuiz);
    }

    async function generateQuiz() {
        const activeLink = document.querySelector('.nav-item.active');
        const category = activeLink ? activeLink.dataset.category : 'all';
        const categoryName = activeLink ? activeLink.textContent : '전체';
        modalTitle.innerHTML = `<i class="fas fa-magic text-yellow-500 mr-3"></i> ${categoryName} 퀴즈`;
        let contentForQuiz = (['home', 'visualization', 'cms', 'all'].includes(category) || !photographyData[category]) ? Object.values(photographyData).flat() : photographyData[category];
        const topics = contentForQuiz.sort(() => 0.5 - Math.random()).slice(0, 15).map(item => item.q).join(', ');
        const prompt = `다음 사진학 주제들을 바탕으로 객관식 퀴즈 5개를 생성해줘: ${topics}. 각 질문은 4개의 선택지를 가져야 하고, 그 중 하나만 정답이어야 해. 질문의 난이도는 '아주 쉬운 문제 1개', '보통 문제 2개', '어려운 문제 2개'로 구성해줘. 질문, 선택지, 정답을 JSON 형식으로 반환해줘.`;
        const responseText = await callGeminiAPI(prompt, true);
        if (!responseText) return;
        try {
            const parsedData = JSON.parse(responseText);
            if (parsedData?.questions?.length > 0) {
                currentQuizData = parsedData; currentQuestionIndex = 0; score = 0;
                displayQuizQuestion();
            } else { throw new Error("Invalid quiz format."); }
        } catch(e) {
            console.error("Quiz parsing error:", e);
            modalResponse.innerHTML = `<p class="text-red-500">퀴즈 생성에 실패했습니다. AI가 유효한 형식을 반환하지 못했습니다.</p>`;
        }
    }

    // --- AI Explanation ---
    async function handleExplanation(e) {
        const button = e.target.closest('.ai-btn');
        if (!button) return;
        const { action, term, desc } = button.dataset;
        let prompt = '';
        if (action === 'explain') {
            modalTitle.innerHTML = `<i class="fas fa-brain text-purple-500 mr-3"></i>"${term}" 쉽게 이해하기`;
            prompt = `사진학 용어인 "${term}"에 대해 핵심만 짚어 입시생이 시험장에서 바로 활용할 수 있도록 간결하게 설명해줘. 현재 설명: ${desc}`;
        } else if (action === 'deepen') {
            modalTitle.innerHTML = `<i class="fas fa-search-plus text-indigo-500 mr-3"></i>"${term}" 깊이 알아보기`;
            prompt = `사진학 개념인 "${term}"에 대해 더 깊이 알고 싶어. 다음 기본 설명을 바탕으로, 관련된 심화 개념, 역사적 배경, 또는 실전 촬영 팁을 포함하여 전문가 수준의 추가 정보를 제공해줘. 현재 설명: ${desc}`;
        }
        if(prompt) {
            const responseText = await callGeminiAPI(prompt, false);
            if(responseText) modalResponse.innerHTML = `<div class="prose max-w-none">${responseText.replace(/\n/g, '<br>')}</div>`;
        }
    }

    // --- Content Rendering ---
    function createCalendar(year, month, events) {
        const monthNames = ["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"];
        const days = ['일', '월', '화', '수', '목', '금', '토'];
        const date = new Date(year, month - 1, 1);
        const firstDay = date.getDay();
        const daysInMonth = new Date(year, month, 0).getDate();
        let html = `<div class="content-card p-6 w-full max-w-4xl mx-auto mb-8"><h3 class="text-xl font-bold text-center mb-4">${year}년 ${monthNames[month-1]}</h3><div class="grid grid-cols-7 gap-1 text-center text-sm font-semibold text-gray-600">${days.map(day => `<div class="${day === '일' ? 'text-red-500' : (day === '토' ? 'text-blue-500' : '')}">${day}</div>`).join('')}</div><div class="grid grid-cols-7 gap-1 mt-2">`;
        html += '<div></div>'.repeat(firstDay);
        for (let day = 1; day <= daysInMonth; day++) {
            const dayEvents = events[day] || [];
            let eventHtml = dayEvents.map(e => `<div class="text-white text-[10px] p-1 rounded-md ${e.color || 'bg-blue-500'} mb-1 truncate" title="${e.title}">${e.title}</div>`).join('');
            const dayOfWeek = (firstDay + day - 1) % 7;
            let dayClass = (dayOfWeek === 0 || dayEvents.some(e => e.isHoliday)) ? 'text-red-500' : (dayOfWeek === 6 ? 'text-blue-500' : '');
            html += `<div class="border p-2 h-28 flex flex-col ${dayEvents.length > 0 ? 'bg-gray-50' : ''}"><span class="font-bold ${dayClass}">${day}</span><div class="mt-1 overflow-y-auto">${eventHtml}</div></div>`;
        }
        html += `</div></div>`;
        return html;
    }

    function createChart(canvasId, label, data, backgroundColor, borderColor) {
        const ctx = document.getElementById(canvasId)?.getContext('2d');
        if (!ctx) return;
        if (charts[canvasId]) charts[canvasId].destroy();
        charts[canvasId] = new Chart(ctx, { type: 'bar', data: { labels: data.map(item => item.label), datasets: [{ label, data: data.map(item => item.value), backgroundColor, borderColor, borderWidth: 1 }] }, options: { maintainAspectRatio: false, scales: { y: { display: false }, x: { grid: { display: false }, ticks: { font: { size: 10 }, autoSkip: true, maxTicksLimit: 15 } } }, plugins: { legend: { display: false }, tooltip: { displayColors: false, callbacks: { label: (context) => data[context.dataIndex].desc || '' } } } } });
    }

    function renderContent(category, searchTerm = '') {
        let html = '';
        if (category === 'home') {
            const eventsForSept = {}; (calendarEvents[9] || []).forEach(e => { (eventsForSept[e.day] = eventsForSept[e.day] || []).push(e); });
            const eventsForOct = {}; (calendarEvents[10] || []).forEach(e => { (eventsForOct[e.day] = eventsForOct[e.day] || []).push(e); });
            html = `<div class="content-card p-6 md:p-8 mb-6 text-center"><h2 class="text-3xl font-bold text-gray-800 mb-2">주요 학사 일정 ✨</h2><p class="text-gray-600">중요한 입시 일정을 확인하세요.</p></div>
                    ${createCalendar(2025, 9, eventsForSept)}${createCalendar(2025, 10, eventsForOct)}`;
        } else if (category === 'visualization') {
            html = `<div class="content-card p-6 md:p-8 mb-6"><h2 class="text-3xl font-bold text-gray-800 mb-2">중요 개념 시각화</h2><p class="text-lg text-gray-600">복잡한 개념들을 도표로 쉽게 이해해보세요.</p></div>
                <div class="content-card mb-4"><div class="question p-6 flex justify-between items-center"><h3 class="text-lg font-bold text-gray-800">노출의 이해: 조리개와 셔터 속도</h3><i class="fas fa-chevron-down"></i></div><div class="answer"><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div><div class="flex justify-center items-center mb-4"><h3 class="text-xl font-bold text-center mr-4">조리개</h3><div class="flex rounded-lg bg-gray-200 p-1 text-sm"><button class="stop-btn active px-3 py-1 rounded-md" data-chart="aperture" data-stop="fullStop">1 스톱</button><button class="stop-btn px-3 py-1 rounded-md" data-chart="aperture" data-stop="thirdStop">1/3 스톱</button></div></div><div class="chart-container"><canvas id="apertureChart"></canvas></div></div><div><div class="flex justify-center items-center mb-4"><h3 class="text-xl font-bold text-center mr-4">셔터 속도</h3><div class="flex rounded-lg bg-gray-200 p-1 text-sm"><button class="stop-btn active px-3 py-1 rounded-md" data-chart="shutter" data-stop="fullStop">1 스톱</button><button class="stop-btn px-3 py-1 rounded-md" data-chart="shutter" data-stop="thirdStop">1/3 스톱</button></div></div><div class="chart-container"><canvas id="shutterChart"></canvas></div></div></div></div></div>
                <div class="content-card mb-4"><div class="question p-6 flex justify-between items-center"><h3 class="text-lg font-bold text-gray-800">필름 특성곡선 (Characteristic Curve)</h3><i class="fas fa-chevron-down"></i></div><div class="answer"><div class="relative w-full max-w-4xl mx-auto mb-4" style="height: 450px;"><svg class="absolute w-full h-full" viewBox="0 0 450 300"><rect x="260" y="25" width="20" height="2" fill="#059669"></rect><text x="285" y="30" font-size="10">저감도 (ISO 100) 필름 (고대비)</text><rect x="260" y="45" width="20" height="2" fill="#DB2777"></rect><text x="285" y="50" font-size="10">고감도 (ISO 400) 필름 (저대비)</text><line x1="60" y1="250" x2="420" y2="250" stroke="#cbd5e1" stroke-width="1"></line><line x1="60" y1="50" x2="60" y2="250" stroke="#cbd5e1" stroke-width="1"></line><text x="50" y="255" font-size="10" text-anchor="end">0.0</text><line x1="55" y1="250" x2="60" y2="250" stroke="#9ca3af" stroke-width="1"></line><text x="50" y="205" font-size="10" text-anchor="end">0.5</text><line x1="55" y1="200" x2="420" y2="200" stroke="#e5e7eb" stroke-width="0.5"></line><text x="50" y="155" font-size="10" text-anchor="end">1.0</text><line x1="55" y1="150" x2="420" y2="150" stroke="#e5e7eb" stroke-width="0.5"></line><text x="50" y="105" font-size="10" text-anchor="end">1.5</text><line x1="55" y1="100" x2="420" y2="100" stroke="#e5e7eb" stroke-width="0.5"></line><text x="50" y="55" font-size="10" text-anchor="end">2.0</text><line x1="55" y1="50" x2="60" y2="50" stroke="#9ca3af" stroke-width="1"></line><text x="120" y="265" font-size="10" text-anchor="middle">-2.0</text><line x1="120" y1="250" x2="120" y2="245" stroke="#9ca3af" stroke-width="1"></line><text x="195" y="265" font-size="10" text-anchor="middle">-1.0</text><line x1="195" y1="250" x2="195" y2="245" stroke="#9ca3af" stroke-width="1"></line><text x="270" y="265" font-size="10" text-anchor="middle">0.0</text><line x1="270" y1="250" x2="270" y2="245" stroke="#9ca3af" stroke-width="1"></line><text x="345" y="265" font-size="10" text-anchor="middle">1.0</text><line x1="345" y1="250" x2="345" y2="245" stroke="#9ca3af" stroke-width="1"></line><text x="420" y="265" font-size="10" text-anchor="end">노광량 (Log Exposure) →</text><text x="20" y="50" font-size="10" text-anchor="middle" transform="rotate(-90 20,50)">농도 (Density) →</text><path d="M 120 240 Q 150 230, 190 180 T 320 70 L 360 60" stroke="#DB2777" stroke-width="2.5" fill="none"></path><path d="M 190 240 Q 220 230, 250 150 T 340 55 L 380 50" stroke="#059669" stroke-width="2.5" fill="none"></path></svg></div><div class="prose max-w-none text-sm">...설명...</div></div></div>
                <div class="content-card mb-4"><div class="question p-6 flex justify-between items-center"><h3 class="text-lg font-bold text-gray-800">존 시스템 (Zone System)</h3><i class="fas fa-chevron-down"></i></div><div class="answer"><p class="text-sm text-gray-600 mb-6">안셀 아담스가 창시한 톤 재현 이론...</p><div class="zone-bar-container"><div class="zone-bar" style="background-color: #000000;">0</div><div class="zone-bar" style="background-color: #1a1a1a;">I</div><div class="zone-bar" style="background-color: #333333;">II</div><div class="zone-bar" style="background-color: #4d4d4d;">III</div><div class="zone-bar" style="background-color: #666666;">IV</div><div class="zone-bar" style="background-color: #808080;">V</div><div class="zone-bar" style="background-color: #999999;">VI</div><div class="zone-bar" style="background-color: #b3b3b3;">VII</div><div class="zone-bar" style="background-color: #cccccc;">VIII</div><div class="zone-bar" style="background-color: #e6e6e6; color: #333;">IX</div><div class="zone-bar" style="background-color: #ffffff; color: #333;">X</div></div><div class="grid grid-cols-3 md:grid-cols-11 gap-4 mt-2"><div class="zone-bar-info"><b>Zone 0</b><p>순수한 검정</p></div>...</div></div></div>`;
        } else if (category === 'cms') {
             html = `<div class="content-card p-6 md:p-8 mb-6 text-center"><h2 class="text-3xl font-bold text-gray-800 mb-2">CMS 가이드</h2></div>
                     <div class="content-card mb-4"><div class="question p-6 flex justify-between items-center"><h3 class="text-lg font-bold text-gray-800">1. 색 관리 시스템(CMS)이란?</h3><i class="fas fa-chevron-down"></i></div><div class="answer"><div class="text-center text-sm text-gray-600 mb-6">...</div><div class="flex flex-col md:flex-row ...">...</div></div></div>
                     <div class="content-card mb-4"><div class="question p-6 flex justify-between items-center"><h3 class="text-lg font-bold text-gray-800">2. 색 공간(Color Space)의 종류</h3><i class="fas fa-chevron-down"></i></div><div class="answer">...</div></div>
                     <div class="content-card mb-4"><div class="question p-6 flex justify-between items-center"><h3 class="text-lg font-bold text-gray-800">3. 주요 작업별 색 공간(Color Space) 예시</h3><i class="fas fa-chevron-down"></i></div><div class="answer">...</div></div>
                     <div class="content-card mb-4"><div class="question p-6 flex justify-between items-center"><h3 class="text-lg font-bold text-gray-800">4. 캘리브레이션 vs. 프로파일링</h3><i class="fas fa-chevron-down"></i></div><div class="answer">...</div></div>`;
        } else {
            let itemsToRender;
            let pageTitle;
            if (searchTerm) {
                pageTitle = `"${searchTerm}"에 대한 검색 결과`;
                const lowerSearchTerm = searchTerm.toLowerCase();
                const jamoSearch = (typeof Jamo !== 'undefined' && Jamo.jamo) ? Jamo.jamo(lowerSearchTerm) : null;
                itemsToRender = Object.values(photographyData).flat().filter(item => {
                    if (!item?.q || !item?.a) return false;
                    const lowerQ = item.q.toLowerCase();
                    if (lowerQ.includes(lowerSearchTerm) || item.a.toLowerCase().includes(lowerSearchTerm)) return true;
                    return jamoSearch && Jamo.jamo(lowerQ).includes(jamoSearch);
                });
            } else {
                pageTitle = document.querySelector(`.nav-item[data-category="${category}"]`)?.textContent || "카테고리";
                itemsToRender = photographyData[category] || [];
            }
            html = `<div class="content-card p-6 md:p-8 mb-6 text-center"><h2 class="text-3xl font-bold text-gray-800 mb-2">${pageTitle}</h2></div>`;
            if (itemsToRender.length > 0) {
                html += itemsToRender.map(item => `<div class="content-card mb-4"><div class="question p-6 flex justify-between items-center"><h3 class="text-lg font-bold text-gray-800">${item.q}</h3><i class="fas fa-chevron-down"></i></div><div class="answer"><div class="prose max-w-none"><p>${item.a.replace(/\n/g, '<br>')}</p></div><div class="mt-4 pt-4 border-t border-gray-200 border-dashed flex flex-wrap gap-2"><button class="ai-btn" data-action="explain" data-term="${item.q.replace(/"/g, '&quot;')}" data-desc="${item.a.replace(/"/g, '&quot;')}"><i class="fas fa-brain"></i>쉽게 설명</button><button class="ai-btn" data-action="deepen" data-term="${item.q.replace(/"/g, '&quot;')}" data-desc="${item.a.replace(/"/g, '&quot;')}"><i class="fas fa-search-plus"></i>깊이 알아보기</button></div></div></div>`).join('');
            } else {
                html += `<div class="content-card p-8 text-center"><p>관련 내용을 찾을 수 없습니다.</p></div>`;
            }
        }
        mainContent.innerHTML = html;
        attachContentEventListeners(category);
    }

    function attachContentEventListeners(category) {
        mainContent.querySelectorAll('.question').forEach(q => q.addEventListener('click', e => {
            const questionDiv = e.currentTarget, answerDiv = questionDiv.nextElementSibling, wasOpen = answerDiv.classList.contains('open');
            document.querySelectorAll('.answer.open').forEach(openAnswer => { openAnswer.classList.remove('open'); openAnswer.previousElementSibling.classList.remove('open'); });
            if (!wasOpen) { questionDiv.classList.add('open'); answerDiv.classList.add('open'); }
        }));
        if (category === 'visualization') {
            setTimeout(() => {
                const updateChart = (chartName, stopType) => { 
                    const data = visualizationData[chartName][stopType]; 
                    const color = chartName === 'aperture' ? ['rgba(75, 192, 192, 0.6)', 'rgba(75, 192, 192, 1)'] : ['rgba(255, 159, 64, 0.6)', 'rgba(255, 159, 64, 1)']; 
                    createChart(`${chartName}Chart`, chartName, data, color[0], color[1]); 
                };
                updateChart('aperture', 'fullStop'); updateChart('shutter', 'fullStop');
                document.querySelectorAll('.stop-btn').forEach(button => button.addEventListener('click', e => { 
                    const { chart, stop } = e.target.dataset;
                    document.querySelectorAll(`[data-chart="${chart}"]`).forEach(btn => btn.classList.remove('active')); 
                    e.target.classList.add('active'); 
                    updateChart(chart, stop); 
                }));
            }, 100);
        }
    }

    // --- Initial Setup & Global Event Listeners ---
    function init() {
        document.querySelectorAll('nav a').forEach(link => link.addEventListener('click', e => {
            e.preventDefault();
            const category = e.currentTarget.dataset.category;
            searchInput.value = '';
            document.querySelectorAll('nav a').forEach(l => l.classList.remove('active'));
            e.currentTarget.classList.add('active');
            renderContent(category);
        }));
        searchInput.addEventListener('input', () => {
            const searchTerm = searchInput.value;
            document.querySelectorAll('nav a').forEach(link => link.classList.remove('active'));
            renderContent(null, searchTerm);
        });
        quizBtn.addEventListener('click', generateQuiz);
        mainContent.addEventListener('click', handleExplanation);
        closeModalBtn.addEventListener('click', hideModal);
        geminiModal.addEventListener('click', e => { if (e.target === geminiModal) hideModal(); });
        document.addEventListener('keydown', e => { if (e.key === "Escape") hideModal(); });
        renderContent('home');
    }
    init();
    </script>
</body>
</html>

